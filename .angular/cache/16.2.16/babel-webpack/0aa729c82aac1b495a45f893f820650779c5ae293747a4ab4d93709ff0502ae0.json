{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/fabio/Desktop/Projetos de Marlon Desenvolvimento Mobile/climaja-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/clima.service\";\nimport * as i2 from \"../services/historico.service\";\nimport * as i3 from \"../services/localizacao.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@ionic/angular\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"../resultados-busca/resultados-busca.component\";\nfunction HomePage_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"div\", 11);\n    i0.ɵɵtext(2, \"\\u26A0\\uFE0F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h3\");\n    i0.ɵɵtext(4, \"Erro ao carregar dados\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ion-button\", 12);\n    i0.ɵɵlistener(\"click\", function HomePage_div_14_Template_ion_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.buscarClima());\n    });\n    i0.ɵɵtext(8, \" Tentar Novamente \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r0.erro);\n  }\n}\nfunction HomePage_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"div\", 14)(2, \"h1\", 15);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 16)(5, \"span\", 17);\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 18);\n    i0.ɵɵelement(9, \"img\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"p\", 20);\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"titlecase\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\", 21);\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"ion-button\", 22);\n    i0.ɵɵlistener(\"click\", function HomePage_div_15_Template_ion_button_click_16_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.definirLocalizacaoAtual());\n    });\n    i0.ɵɵelement(17, \"ion-icon\", 23);\n    i0.ɵɵtext(18, \" Definir como Localiza\\u00E7\\u00E3o Atual \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r1.climaAtual.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(7, 6, ctx_r1.climaAtual.main.temp, \"1.0-0\"), \"\\u00B0C\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", ctx_r1.getIconeClima(ctx_r1.climaAtual.weather[0].icon), i0.ɵɵsanitizeUrl)(\"alt\", ctx_r1.climaAtual.weather[0].description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(12, 9, ctx_r1.climaAtual.weather[0].description), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Sensa\\u00E7\\u00E3o t\\u00E9rmica \", i0.ɵɵpipeBind2(15, 11, ctx_r1.climaAtual.main.feels_like, \"1.0-0\"), \"\\u00B0C \");\n  }\n}\n/**\n * Componente para a página inicial do aplicativo.\n */\nlet HomePage = /*#__PURE__*/(() => {\n  class HomePage {\n    /**\n    * Construtor do componente.\n    * @param climaService Serviço para buscar dados do clima.\n    * @param historicoService Serviço para gerenciar o histórico de buscas.\n    * @param localizacaoService Serviço para gerenciar a localização atual.\n    * @param router Serviço para navegar entre as páginas.\n    * @param alertController Controlador para exibir mensagens de alerta.\n    * @param toastController Controlador para exibir notificações toast.\n    */\n    constructor(climaService, historicoService, localizacaoService, router, alertController, toastController) {\n      this.climaService = climaService;\n      this.historicoService = historicoService;\n      this.localizacaoService = localizacaoService;\n      this.router = router;\n      this.alertController = alertController;\n      this.toastController = toastController;\n      /**\n      * Cidade a ser buscada.\n      */\n      this.cidade = '';\n      /**\n       * Sugestões de cidades para a busca.\n       */\n      this.sugestoes = [];\n      /**\n       * Dados do clima atual da cidade buscada.\n       */\n      this.climaAtual = null;\n      /**\n       * Indica se a aplicação está carregando dados.\n       */\n      this.carregando = false;\n      /**\n       * Mensagem de erro a ser exibida.\n       */\n      this.erro = '';\n      /**\n       * Subject para controlar a busca de sugestões.\n       */\n      this.searchTerm = new Subject();\n    }\n    /**\n     * Método chamado quando o componente é inicializado.\n     */\n    ngOnInit() {\n      // Configura o searchTerm para buscar sugestões após um período de inatividade\n      this.searchTerm.pipe(distinctUntilChanged() // Emite apenas se o valor é diferente do anterior\n      ).subscribe(value => {\n        this.buscarSugestoes(value);\n      });\n    }\n    /**\n     * Busca os dados do clima para a cidade especificada.\n     */\n    buscarClima() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        console.log('Método buscarClima() chamado!');\n        console.log('Cidade:', _this.cidade);\n        // Verifica se a cidade foi informada\n        if (!_this.cidade || !_this.cidade.trim()) {\n          _this.mostrarErro('Por favor, digite o nome de uma cidade');\n          return;\n        }\n        _this.erro = '';\n        _this.climaAtual = null;\n        try {\n          _this.sugestoes = [];\n          // Busca os dados do clima no serviço\n          _this.climaService.getClima(_this.cidade.trim()).subscribe({\n            next: clima => {\n              console.log('Dados do clima recebidos:', clima);\n              _this.climaAtual = clima;\n              // Salva no histórico usando o serviço\n              _this.historicoService.adicionarHistorico({\n                cidade: clima.name || _this.cidade,\n                temperatura: clima.main.temp,\n                descricao: clima.weather[0].description,\n                data: new Date().toISOString(),\n                icone: clima.weather[0].icon\n              });\n              console.log('Busca concluída com sucesso');\n              _this.mostrarToast('Clima de ' + _this.cidade + ' carregado com sucesso!', 'success');\n              // Remove a navegação para a página de detalhes\n              // this.router.navigate(['/detalhes-clima'], {\n              //   queryParams: {\n              //     cidade: clima.name || this.cidade,\n              //   }\n              // });\n            },\n            error: error => {\n              console.error('Erro ao buscar clima:', error);\n              _this.erro = 'Cidade não encontrada. Verifique o nome e tente novamente.';\n              _this.climaAtual = null;\n              _this.mostrarToast(_this.erro, 'danger');\n            }\n          });\n        } catch (error) {\n          console.error('Erro inesperado:', error);\n          _this.erro = 'Erro inesperado. Tente novamente.';\n          _this.climaAtual = null;\n          _this.mostrarToast(_this.erro, 'danger');\n        }\n      })();\n    }\n    /**\n     * Navega para a página de detalhes do clima.\n     * @param clima Dados do clima para a cidade selecionada.\n     */\n    verDetalhes(clima) {\n      this.router.navigate(['/detalhes-clima'], {\n        queryParams: {\n          cidade: clima.name\n        }\n      });\n    }\n    /**\n     * Exibe uma mensagem de erro.\n     * @param mensagem Mensagem de erro a ser exibida.\n     */\n    mostrarErro(mensagem) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const alert = yield _this2.alertController.create({\n          header: 'Erro',\n          message: mensagem,\n          buttons: ['OK']\n        });\n        yield alert.present();\n      })();\n    }\n    /**\n     * Exibe uma notificação toast.\n     * @param mensagem Mensagem a ser exibida no toast.\n     * @param cor Cor do toast.\n     */\n    mostrarToast(mensagem, cor) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const toast = yield _this3.toastController.create({\n          message: mensagem,\n          duration: 2000,\n          color: cor\n        });\n        toast.present();\n      })();\n    }\n    /**\n     * Obtém a URL do ícone do clima.\n     * @param icone Código do ícone do clima.\n     * @returns URL do ícone do clima.\n     */\n    getIconeClima(icone) {\n      return `https://openweathermap.org/img/wn/${icone}@2x.png`;\n    }\n    /**\n     * Manipula a entrada de busca e gera sugestões.\n     * @param event Evento de entrada de texto.\n     */\n    onSearchInput(event) {\n      const value = event.target.value;\n      this.searchTerm.next(value);\n    }\n    /**\n     * Busca sugestões de cidades com base no texto digitado.\n     * @param cidade Texto da cidade a ser buscada.\n     */\n    buscarSugestoes(cidade) {\n      if (cidade.trim() === '') {\n        this.sugestoes = [];\n        return;\n      }\n      this.climaService.getSugestoes(cidade).subscribe({\n        next: sugestoes => {\n          this.sugestoes = sugestoes.map(sugestao => `${sugestao.name}, ${sugestao.country}`);\n        },\n        error: error => {\n          console.error('Erro ao buscar sugestões:', error);\n          this.sugestoes = [];\n        }\n      });\n    }\n    /**\n     * Seleciona uma sugestão da lista.\n     * @param sugestao Sugestão selecionada.\n     */\n    selecionarSugestao(sugestao) {\n      this.cidade = sugestao;\n      this.buscarClima();\n    }\n    /**\n     * Atualiza a cidade com o valor digitado no campo de busca.\n     * @param event Evento de entrada de texto.\n     */\n    onInputChange(event) {\n      this.cidade = event.target.value;\n    }\n    /**\n     * Permite a busca ao pressionar a tecla \"Enter\".\n     * @param event Evento de tecla pressionada.\n     */\n    onKeyPress(event) {\n      console.log('onKeyPress chamado!');\n      if (event.key === 'Enter') {\n        this.buscarClima();\n      }\n    }\n    /**\n     * Define a localização atual com base no clima atual.\n     */\n    definirLocalizacaoAtual() {\n      if (this.climaAtual) {\n        this.localizacaoService.definirLocalizacaoAtual(this.climaAtual.name);\n        console.log('Localização atual definida:', this.climaAtual.name);\n      } else {\n        this.mostrarErro('Por favor, digite o nome de uma cidade');\n      }\n    }\n    static {\n      this.ɵfac = function HomePage_Factory(t) {\n        return new (t || HomePage)(i0.ɵɵdirectiveInject(i1.ClimaService), i0.ɵɵdirectiveInject(i2.HistoricoService), i0.ɵɵdirectiveInject(i3.LocalizacaoService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.AlertController), i0.ɵɵdirectiveInject(i5.ToastController));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: HomePage,\n        selectors: [[\"app-home\"]],\n        decls: 16,\n        vars: 4,\n        consts: [[\"slot\", \"start\"], [1, \"google-style-container\"], [1, \"app-info\"], [1, \"app-title\"], [1, \"app-subtitle\"], [1, \"search-section\"], [\"placeholder\", \"Buscar cidade...\", \"showCancelButton\", \"never\", \"clearIcon\", \"close-outline\", 1, \"custom-searchbar\", 3, \"ngModel\", \"ngModelChange\", \"keyup.enter\", \"input\", \"ionChange\"], [3, \"sugestoes\", \"cidadeSelecionada\"], [\"class\", \"glass-card error-state\", 4, \"ngIf\"], [\"class\", \"main-weather animate-in\", 4, \"ngIf\"], [1, \"glass-card\", \"error-state\"], [1, \"error-icon\"], [\"fill\", \"clear\", 3, \"click\"], [1, \"main-weather\", \"animate-in\"], [1, \"location-section\"], [1, \"city-name\"], [1, \"temperature-section\"], [1, \"temperature-display\"], [1, \"weather-icon-container\"], [1, \"main-weather-icon\", 3, \"src\", \"alt\"], [1, \"weather-description\"], [1, \"feels-like\"], [\"expand\", \"block\", \"fill\", \"clear\", 1, \"set-location-btn\", 3, \"click\"], [\"name\", \"location-outline\", \"slot\", \"start\"]],\n        template: function HomePage_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n            i0.ɵɵelement(3, \"ion-menu-button\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(4, \"ion-content\")(5, \"div\", 1)(6, \"div\", 2)(7, \"h1\", 3);\n            i0.ɵɵtext(8, \"ClimaJ\\u00E1 \\uD83C\\uDF24\\uFE0F\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"p\", 4);\n            i0.ɵɵtext(10, \"Previs\\u00E3o do Tempo\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(11, \"div\", 5)(12, \"ion-searchbar\", 6);\n            i0.ɵɵlistener(\"ngModelChange\", function HomePage_Template_ion_searchbar_ngModelChange_12_listener($event) {\n              return ctx.cidade = $event;\n            })(\"keyup.enter\", function HomePage_Template_ion_searchbar_keyup_enter_12_listener($event) {\n              return ctx.onKeyPress($event);\n            })(\"input\", function HomePage_Template_ion_searchbar_input_12_listener($event) {\n              return ctx.onInputChange($event);\n            })(\"ionChange\", function HomePage_Template_ion_searchbar_ionChange_12_listener($event) {\n              return ctx.onSearchInput($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"app-resultados-busca\", 7);\n            i0.ɵɵlistener(\"cidadeSelecionada\", function HomePage_Template_app_resultados_busca_cidadeSelecionada_13_listener($event) {\n              return ctx.selecionarSugestao($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(14, HomePage_div_14_Template, 9, 1, \"div\", 8);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(15, HomePage_div_15_Template, 19, 14, \"div\", 9);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(12);\n            i0.ɵɵproperty(\"ngModel\", ctx.cidade);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"sugestoes\", ctx.sugestoes);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.erro);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.climaAtual && !ctx.erro);\n          }\n        },\n        dependencies: [i5.IonButton, i5.IonButtons, i5.IonContent, i5.IonHeader, i5.IonIcon, i5.IonMenuButton, i5.IonSearchbar, i5.IonToolbar, i5.TextValueAccessor, i6.NgIf, i7.NgControlStatus, i7.NgModel, i8.ResultadosBuscaComponent, i6.DecimalPipe, i6.TitleCasePipe],\n        styles: [\"ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--border-color: transparent}ion-content[_ngcontent-%COMP%]{--background: var(--ion-background-color);display:flex;flex-direction:column;height:100%}.google-style-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:100%;padding:20px}.logo-container[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}.logo-container[_ngcontent-%COMP%]   .app-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:8px}.search-section[_ngcontent-%COMP%]{width:100%;max-width:584px;margin:0 auto;padding:0 16px;position:relative;z-index:2}.search-section[_ngcontent-%COMP%]   .app-info[_ngcontent-%COMP%]{text-align:center;margin-top:16px}.search-section[_ngcontent-%COMP%]   .app-info[_ngcontent-%COMP%]   .app-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:8px}.search-section[_ngcontent-%COMP%]   .app-info[_ngcontent-%COMP%]   .app-subtitle[_ngcontent-%COMP%]{color:var(--ion-color-medium)}ion-searchbar[_ngcontent-%COMP%]{--background: #fff;--border-radius: 24px;--box-shadow: 0 2px 5px rgba(0, 0, 0, .1);--placeholder-color: #5f6368;--color: #202124;--icon-color: #9aa0a6;height:44px;padding:0}ion-searchbar[_ngcontent-%COMP%]::part(container){height:44px}ion-searchbar[_ngcontent-%COMP%]::part(search-icon){color:#9aa0a6}ion-searchbar[_ngcontent-%COMP%]:hover{--box-shadow: 0 3px 8px rgba(0, 0, 0, .15)}.suggestions-list[_ngcontent-%COMP%]{position:absolute;top:52px;left:16px;right:16px;max-width:584px;margin:0 auto;background:#fff;border-radius:0 0 24px 24px;box-shadow:0 4px 6px #0000001a;z-index:1}.suggestion-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 16px;--min-height: 48px;--background: transparent;--color: #202124;font-size:14px}.suggestion-item[_ngcontent-%COMP%]:hover{--background: #f8f9fa}.suggestion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#9aa0a6;margin-right:12px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:16px;margin-top:32px}.loading-container[_ngcontent-%COMP%]   .loading-text[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.main-weather[_ngcontent-%COMP%]{padding:16px;margin-top:32px;animation:_ngcontent-%COMP%_slideUp .3s ease-out}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .city-name[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px;color:var(--text-primary)}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .temperature-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:16px}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .temperature-section[_ngcontent-%COMP%]   .temperature-display[_ngcontent-%COMP%]{font-size:48px;font-weight:700;color:var(--text-primary)}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .temperature-section[_ngcontent-%COMP%]   .weather-icon-container[_ngcontent-%COMP%]{width:64px;height:64px}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .temperature-section[_ngcontent-%COMP%]   .weather-icon-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .weather-description[_ngcontent-%COMP%]{font-size:18px;margin:8px 0;color:var(--text-primary)}.main-weather[_ngcontent-%COMP%]   .location-section[_ngcontent-%COMP%]   .feels-like[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.glass-card[_ngcontent-%COMP%]{background:rgba(255,255,255,.1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:16px;padding:16px;margin:16px}.weather-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.detail-card[_ngcontent-%COMP%]{text-align:center;padding:12px}.detail-label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px;margin-bottom:4px}.detail-value[_ngcontent-%COMP%]{font-size:16px;font-weight:500}.details-btn[_ngcontent-%COMP%]{margin:16px}.error-state[_ngcontent-%COMP%]{text-align:center;padding:32px 16px}.error-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px}h3[_ngcontent-%COMP%]{color:var(--ion-color-danger);margin-bottom:8px}p[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.animate-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}\"]\n      });\n    }\n  }\n  return HomePage;\n})();\nexport { HomePage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}